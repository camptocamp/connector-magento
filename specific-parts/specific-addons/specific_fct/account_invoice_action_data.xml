<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>
        <record id="send_invoice_mail" model="ir.actions.server">
            <field name="code">if (object.type in ('out_invoice') and not object.partner_id.opt_out: object.edi_export_and_email(template_ext_id='specific_fct.email_template_customer_invoice', context=context)</field>
            <field name="state">code</field>
            <field name="type">ir.actions.server</field>
            <field name="model_id" ref="account.model_account_invoice"/>
            <field name="condition">True</field>
            <field name="name">Send an email with invoice after delivery</field>
        </record>

    </data>
    <!-- Mail template and workflow bindings are done in a NOUPDATE block
         so users can freely customize/delete them -->
    <data noupdate="1">

        <record id="account.act_open" model="workflow.activity">
            <field name="action_id" ref="specific_fct.send_invoice_mail"/>
        </record>
        <!--Email template -->
        <record id="email_template_customer_invoice" model="email.template">
            <field name="name">Envoi de mail avec facture au client</field>
            <field name="email_from">contact@debonix.fr</field>
            <field name="subject">Votre facture (reference:${object.number})</field>
            <field name="email_to">${object.address_invoice_id.email or object.partner_id.email}</field>
            <field name="model_id" ref="account.model_account_invoice"/>
            <field name="auto_delete" eval="True"/>
            <field name="lang">${object.partner_id.lang or 'fr_FR'}</field>
            <field name="body_html"></field>
            <field name="body_text"><![CDATA[
                Bonjour,
                Nous vous remercions pour votre achat.
                Votre commande vient d'être expédiée, vous devriez la réceptionner sous un délai maximum de 48h.
                Veuillez trouver ci-joint votRe facture ${object.name}.

                Cordialement,

                Merci et à bientôt sur www.debonix.fr 

                DEBONIX 25,
                Avenue du Pont de Tasset
                74960 MEYTHET Tel: 04.50.09.46.87
                Fax: 04.82.53.13.88
                Email: contact@debonix.fr
            ]]></field>
            <field name="report_template" ref="account.account_invoices"/>
            <field name="report_name">facture_${object.name}</field>
        </record>
    </data>
</openerp>

